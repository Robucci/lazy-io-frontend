<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Bots - LAZY.IO</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        /* Style pour les sliders */
        .slider-thumb::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: white;
            border: 3px solid #a855f7;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
            transition: all 0.2s;
        }

        .slider-thumb::-webkit-slider-thumb:hover {
            transform: scale(1.15);
            border-color: #fbbf24;
            box-shadow: 0 0 12px rgba(251, 191, 36, 0.6);
        }

        .slider-thumb::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: white;
            border: 3px solid #a855f7;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }

        .slider-thumb::-moz-range-thumb:hover {
            transform: scale(1.15);
            border-color: #fbbf24;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-950 via-blue-950 to-slate-900 text-white">
    <!-- Header -->
    <header class="bg-slate-900/80 backdrop-blur border-b border-blue-500/30">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <h1 class="text-2xl font-black text-white">LAZY<span class="text-blue-300">.io</span></h1>
            <div class="flex items-center gap-4">
                <span class="text-blue-200" id="userName">Chargement...</span>
                <button onclick="handleLogout()" class="text-red-400 hover:text-red-300">D√©connexion</button>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <div class="bg-slate-900/50 border-b border-blue-500/20">
        <div class="container mx-auto px-4">
            <nav class="flex gap-6 py-3">
                <a href="dashboard.html" class="text-blue-300 hover:text-white transition pb-3">
                    Dashboard
                </a>
                <a href="trading_bots.html" class="text-white font-bold border-b-2 border-blue-400 pb-3">
                    Trading Bots
                </a>
                <a href="compte.html" class="text-blue-300 hover:text-white transition pb-3">
                    Compte
                </a>
            </nav>
        </div>
    </div>

    <div class="container mx-auto px-4 py-8">
        <!-- Wallet Info -->
        <div id="walletInfo" class=" hidden bg-slate-800/60 backdrop-blur rounded-xl p-4 mb-6 border border-blue-500/20"">
            <div class="flex items-center gap-2">
                <span class="text-blue-200 text-sm">Wallet connect√©:</span>
                <span class="text-white font-mono text-sm" id="walletAddress">0x...</span>
            </div>
        </div>

        <!-- Loading State -->
        <div id="loadingState" class="text-center py-12">
            <div class="text-4xl mb-4">‚è≥</div>
            <p class="text-blue-200">Chargement de vos bots...</p>
        </div>

        <!-- Error State -->
        <div id="errorState" class="hidden bg-red-500/20 border-2 border-red-400 rounded-xl p-6 mb-8">
            <h3 class="text-xl font-bold text-red-300 mb-2">Erreur</h3>
            <p class="text-red-200" id="errorMessage"></p>
            <button onclick="loadBots()" class="mt-4 px-4 py-2 bg-red-500 hover:bg-red-400 text-white rounded-lg">
                R√©essayer
            </button>
        </div>

        <!-- Bots Grid -->
        <div id="botsGrid" class="hidden grid md:grid-cols-3 gap-6">
            <!-- Les bots seront inject√©s ici -->
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/auth.js"></script>
    <script src="js/api.js"></script>
    <script>
        // Logos crypto SVG
        const cryptoLogos = {
            'BTC': `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" width="32" height="32">
                <g fill="none" fill-rule="evenodd">
                    <circle cx="16" cy="16" r="16" fill="#F7931A"/>
                    <path fill="#FFF" fill-rule="nonzero" d="M23.189 14.02c.314-2.096-1.283-3.223-3.465-3.975l.708-2.84-1.728-.43-.69 2.765c-.454-.114-.92-.22-1.385-.326l.695-2.783L15.596 6l-.708 2.839c-.376-.086-.746-.17-1.104-.26l.002-.009-2.384-.595-.46 1.846s1.283.294 1.256.312c.7.175.826.638.805 1.006l-.806 3.235c.048.012.11.03.18.057l-.183-.045-1.13 4.532c-.086.212-.303.531-.793.41.018.025-1.256-.313-1.256-.313l-.858 1.978 2.25.561c.418.105.828.215 1.231.318l-.715 2.872 1.727.43.708-2.84c.472.127.93.245 1.378.357l-.706 2.828 1.728.43.715-2.866c2.948.558 5.164.333 6.097-2.333.752-2.146-.037-3.385-1.588-4.192 1.13-.26 1.98-1.003 2.207-2.538zm-3.95 5.538c-.533 2.147-4.148.986-5.32.695l.95-3.805c1.172.293 4.929.872 4.37 3.11zm.535-5.569c-.487 1.953-3.495.96-4.47.717l.86-3.45c.975.243 4.118.696 3.61 2.733z"/>
                </g>
            </svg>`,
            'ETH': `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" width="32" height="32">
                <g fill="none" fill-rule="evenodd">
                    <circle cx="16" cy="16" r="16" fill="#627EEA"/>
                    <g fill="#FFF" fill-rule="nonzero">
                        <path fill-opacity=".602" d="M16.498 4v8.87l7.497 3.35z"/>
                        <path d="M16.498 4L9 16.22l7.498-3.35z"/>
                        <path fill-opacity=".602" d="M16.498 21.968v6.027L24 17.616z"/>
                        <path d="M16.498 27.995v-6.028L9 17.616z"/>
                        <path fill-opacity=".2" d="M16.498 20.573l7.497-4.353-7.497-3.348z"/>
                        <path fill-opacity=".602" d="M9 16.22l7.498 4.353v-7.701z"/>
                    </g>
                </g>
            </svg>`,
            'SOL': `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" width="32" height="32">
                <defs>
                    <linearGradient id="solana-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#00FFA3"/>
                        <stop offset="100%" style="stop-color:#DC1FFF"/>
                    </linearGradient>
                </defs>
                <circle cx="16" cy="16" r="16" fill="url(#solana-gradient)"/>
                <path d="M7.5 19.5l3-3h14l-3 3zm0-7l3-3h14l-3 3zm17 3.5l-3 3h-14l3-3z" fill="#FFF"/>
            </svg>`
        };

        if (!requireAuth()) {}

        const userData = getUserData();
        if (userData) {
            document.getElementById('userName').textContent = userData.name || userData.email;
        }

        function getStatusBadge(status) {
            const badges = {
                'active': '<span class="px-3 py-1 bg-green-500/20 text-green-400 rounded-full text-sm font-bold">ACTIF</span>',
                'provisioning': '<span class="px-3 py-1 bg-yellow-500/20 text-yellow-400 rounded-full text-sm font-bold">D√âMARRAGE</span>',
                'stopped': '<span class="px-3 py-1 bg-gray-500/20 text-gray-400 rounded-full text-sm font-bold">ARR√äT√â</span>',
                'error': '<span class="px-3 py-1 bg-red-500/20 text-red-400 rounded-full text-sm font-bold">ERREUR</span>'
            };
            return badges[status] || badges['stopped'];
        }

        function getLeverageMax(crypto) {
            const limits = { 'BTC': 40, 'ETH': 25, 'SOL': 20 };
            return limits[crypto] || 40;
        }

function getStyleLabel(style) {
    console.log('Style from DB:', style); // DEBUG
    // Supporter les deux formats : fran√ßais et anglais
    if (style === 'aggressive' || style === 'agressif') {
        return 'Agressif';
    }
    return 'Safe';
}

        // Cr√©er une carte de bot avec sliders int√©gr√©s
function createBotCard(bot) {
            const versionLabel = bot.tier === 'elite' ? 'Elite' : 'Standard';
            const styleLabel = getStyleLabel(bot.style);
            
            return `
                <div class="bg-slate-800/60 backdrop-blur rounded-xl p-6 border border-blue-500/20">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8">
                                ${cryptoLogos[bot.crypto]}
                            </div>
                            <h3 class="text-2xl font-bold text-white">Bot ${bot.crypto}</h3>
                        </div>
                        ${getStatusBadge(bot.status)}
                    </div>
                    
                     <!-- üî• LIVE STATUS CARD - HAUTEUR FIXE -->
                        <div class="bg-slate-900/50 rounded-lg p-4 mb-4 border border-blue-500/10 min-h-[260px] flex flex-col">
                        <div class="text-xs text-blue-300 font-bold mb-3">Statut Live</div>
                        
                        <!-- Ligne sup√©rieure : Prix + Indicateurs -->
                        <div class="grid grid-cols-2 gap-4 mb-3 px-2">
                            <div>
                                <div class="text-xs text-gray-400 mb-1">Prix</div>
                                <div id="live-price-${bot.id}"></div>
                            </div>
                            <div class="text-center">
                                <div class="text-xs text-gray-400 mb-1">Indicateurs</div>
                                <div id="live-indicators-${bot.id}"></div>
                            </div>
                        </div>
                        
                        <!-- Position (toute la largeur) -->
                        <div class="flex-1 px-2">
                            <div class="text-xs text-gray-400 mb-2">Position</div>
                            <div id="live-position-${bot.id}"></div>
                        </div>
                        
                        <!-- MAJ en bas √† droite -->
                        <div class="text-xs text-gray-500 text-right mt-auto pt-2" id="live-update-${bot.id}"></div>
                    </div>
                    
                    <!-- Affichage des valeurs actuelles -->
                    <div class="space-y-3 mb-4">
                        <div class="flex justify-between text-sm">
                            <span class="text-blue-200">Version:</span>
                            <span class="text-white font-bold">${versionLabel} + ${styleLabel}</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-blue-200">Risk/Trade:</span>
                            <span class="text-white font-bold">${bot.risk_pct || 7.5}%</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-blue-200">Leverage:</span>
                            <span class="text-white font-bold">${bot.leverage || getLeverageMax(bot.crypto)}x</span>
                        </div>
                    </div>

                    <!-- Bouton Modifier -->
                    <button onclick="toggleSettings('${bot.id}')" 
                            class="w-full py-2 mb-3 bg-blue-600 hover:bg-blue-500 text-white font-bold rounded-lg transition">
                        ‚öôÔ∏è Modifier
                    </button>

                    <!-- Zone de modification (cach√©e par d√©faut) -->
                    <div id="settings-${bot.id}" class="hidden space-y-4 mb-4 border-t border-blue-500/30 pt-4">
                        <!-- Risk % -->
                        <div>
                            <label class="block text-blue-200 text-sm mb-2">
                                Risk par Trade: <span id="risk-value-${bot.id}" class="text-yellow-400 font-bold">${bot.risk_pct || 7.5}</span>%
                            </label>
                            <input type="range" 
                                   id="risk-slider-${bot.id}"
                                   value="${bot.risk_pct || 7.5}"
                                   min="0.5" 
                                   max="100" 
                                   step="0.5"
                                   class="w-full h-2 bg-gradient-to-r from-blue-600 to-pink-600 rounded-lg appearance-none cursor-pointer slider-thumb"
                                   oninput="updateRiskValue('${bot.id}', this.value)">
                            <div class="flex justify-between text-xs text-blue-400 mt-1">
                                <span>0.5%</span>
                                <span>100%</span>
                            </div>
                        </div>

                        <!-- Leverage -->
                        <div>
                            <label class="block text-blue-200 text-sm mb-2">
                                Leverage: <span id="leverage-value-${bot.id}" class="text-yellow-400 font-bold">${bot.leverage || getLeverageMax(bot.crypto)}</span>x
                            </label>
                            <input type="range" 
                                   id="leverage-slider-${bot.id}"
                                   value="${bot.leverage || getLeverageMax(bot.crypto)}"
                                   min="1" 
                                   max="${getLeverageMax(bot.crypto)}"
                                   step="1"
                                   class="w-full h-2 bg-gradient-to-r from-blue-600 to-pink-600 rounded-lg appearance-none cursor-pointer slider-thumb"
                                   oninput="updateLeverageValue('${bot.id}', this.value)">
                            <div class="flex justify-between text-xs text-blue-400 mt-1">
                                <span>1x</span>
                                <span>${getLeverageMax(bot.crypto)}x</span>
                            </div>
                        </div>

                        <button type="button" 
                                onclick="saveSettings('${bot.id}')"
                                class="w-full py-2 bg-green-600 hover:bg-green-500 text-white font-bold rounded-lg transition">
                            üíæ Sauvegarder
                        </button>
                    </div>

                    <!-- Bouton Start/Stop -->
                    ${bot.status === 'active' ? `
                        <button onclick="stopBot('${bot.id}')" 
                                class="w-full py-2 bg-red-600 hover:bg-red-500 text-white font-bold rounded-lg transition">
                            ‚èπÔ∏è Arr√™ter
                        </button>
                    ` : bot.status === 'stopped' ? `
                        <button onclick="startBot('${bot.id}')" 
                                class="w-full py-2 bg-green-600 hover:bg-green-500 text-white font-bold rounded-lg transition">
                            ‚ñ∂Ô∏è D√©marrer
                        </button>
                    ` : `
                        <button disabled
                                class="w-full py-2 bg-gray-600 text-gray-300 rounded-lg opacity-50 cursor-not-allowed">
                            ${bot.status === 'provisioning' ? 'Provisioning...' : 'Indisponible'}
                        </button>
                    `}
                </div>
            `;
        }

        function toggleSettings(botId) {
            const settingsDiv = document.getElementById(`settings-${botId}`);
            settingsDiv.classList.toggle('hidden');
        }

        function updateRiskValue(botId, value) {
            document.getElementById(`risk-value-${botId}`).textContent = value;
        }

        function updateLeverageValue(botId, value) {
            document.getElementById(`leverage-value-${botId}`).textContent = value;
        }

        async function saveSettings(botId) {
            const token = localStorage.getItem('token');
            const risk = document.getElementById(`risk-slider-${botId}`).value;
            const leverage = document.getElementById(`leverage-slider-${botId}`).value;
            
            try {
                await fetch(`${API_BASE_URL}/admin/update-bot-config/${botId}/risk_pct/${risk}`, {
                    method: 'PUT',
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                await fetch(`${API_BASE_URL}/admin/update-bot-config/${botId}/leverage/${leverage}`, {
                    method: 'PUT',
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                alert('Param√®tres sauvegard√©s avec succ√®s !');
                setTimeout(() => location.reload(), 1000);
                
            } catch (error) {
                console.error('Erreur sauvegarde:', error);
                alert('Erreur lors de la sauvegarde');
            }
        }

        async function loadBots() {
            const loadingState = document.getElementById('loadingState');
            const errorState = document.getElementById('errorState');
            const botsGrid = document.getElementById('botsGrid');
            const walletInfo = document.getElementById('walletInfo');
            
            try {
                // Charger wallet address
                const response = await fetch(`${API_BASE_URL}/hyperliquid/config`, {
                    headers: { 'Authorization': `Bearer ${getAuthToken()}` }
                });
                
                if (response.ok) {
                    const config = await response.json();
                    if (config.wallet_address) {
                        const shortAddr = config.wallet_address.substring(0, 6) + '...' + config.wallet_address.substring(config.wallet_address.length - 4);
                        document.getElementById('walletAddress').textContent = shortAddr;
                        walletInfo.classList.remove('hidden');
                    }
                }
                
// Charger les bots
                const bots = await getUserBots();
                botsGrid.innerHTML = bots.map(bot => createBotCard(bot)).join('');
                botsGrid.classList.remove('hidden');
                loadingState.classList.add('hidden');
                
                // D√©marrer le polling pour chaque bot
                bots.forEach(bot => {
                    startLiveStatusPolling(bot.id);
                });
                
            } catch (error) {
                console.error('Error loading bots:', error);
                loadingState.classList.add('hidden');
                errorState.classList.remove('hidden');
                document.getElementById('errorMessage').textContent = error.message || 'Erreur de chargement des bots';
            }
        }

async function stopBot(botId) {
    if (!confirm('√ätes-vous s√ªr de vouloir arr√™ter ce bot ?')) return;
    try {
        await fetch(`${API_BASE_URL}/admin/stop-bot/${botId}`, {
            method: 'POST',
            headers: { 'Authorization': `Bearer ${getAuthToken()}` }
        });
        alert('Bot arr√™t√© !');
        // Recharger automatiquement
        setTimeout(() => location.reload(), 1000);
    } catch (error) {
        alert('Erreur: ' + error.message);
    }
}

async function startBot(botId) {
    if (!confirm('√ätes-vous s√ªr de vouloir d√©marrer ce bot ?')) return;
    try {
        await fetch(`${API_BASE_URL}/admin/start-bot/${botId}`, {
            method: 'POST',
            headers: { 'Authorization': `Bearer ${getAuthToken()}` }
        });
        alert('Bot d√©marr√© !');
        // Recharger automatiquement
        setTimeout(() => location.reload(), 1000);
    } catch (error) {
        alert('Erreur: ' + error.message);
    }
}

        function handleLogout() {
            if (confirm('√ätes-vous s√ªr de vouloir vous d√©connecter ?')) {
                logout();
            }
        }

// ========== LIVE STATUS POLLING ==========
        
        // Variables globales pour le live status
        let liveStatusIntervals = {};

        // Fonction pour r√©cup√©rer le statut live d'un bot
        async function fetchLiveStatus(botId) {
            try {
                const response = await fetch(`${API_BASE_URL}/live/status/${botId}`, {
                    headers: { 'Authorization': `Bearer ${getAuthToken()}` }
                });
                
                if (!response.ok) {
                    console.error(`Erreur live status bot ${botId}:`, response.status);
                    return null;
                }
                
                return await response.json();
            } catch (error) {
                console.error(`Erreur fetch live status:`, error);
                return null;
            }
        }

        // Fonction pour mettre √† jour l'affichage du statut live
function updateLiveStatusDisplay(botId, data) {
            if (!data) return;
            
            const priceEl = document.getElementById(`live-price-${botId}`);
            const indicatorsEl = document.getElementById(`live-indicators-${botId}`);
            const positionEl = document.getElementById(`live-position-${botId}`);
            const updateTimeEl = document.getElementById(`live-update-${botId}`);
            
            // Prix
            if (priceEl) {
                const priceChange = data.price_change_24h;
                const isPositive = priceChange >= 0;
                const color = isPositive ? 'text-green-400' : 'text-red-400';
                const bgColor = isPositive ? 'bg-green-500/10' : 'bg-red-500/10';
                const sign = isPositive ? '+' : '';
                const arrow = isPositive ? '‚ñ≤' : '‚ñº';
                
                priceEl.innerHTML = `
                    <div class="text-lg font-bold mb-1">$${data.price.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</div>
                    <div class="${color} ${bgColor} text-xs font-semibold px-2 py-0.5 rounded inline-flex items-center gap-1">
                        <span>${arrow}</span>
                        <span>${sign}${priceChange.toFixed(2)}%</span>
                    </div>
                `;
            }
            
            // Indicateurs
            if (indicatorsEl) {
                const validatedCount = data.indicators.validated;
                const totalCount = data.indicators.total;
                
                if (data.position.active) {
                    indicatorsEl.innerHTML = '<span class="text-gray-500 text-sm">‚Äî</span>';
                } else {
                    const statusEmoji = validatedCount === totalCount ? '‚úÖ' : validatedCount >= 2 ? '‚ö†Ô∏è' : '‚ùå';
                    indicatorsEl.innerHTML = `
                        <span class="text-lg font-bold">${validatedCount}/${totalCount}</span>
                        <span class="ml-1">${statusEmoji}</span>
                    `;
                }
            }
            
            // Position
            if (positionEl) {
                if (data.position.active) {
                    const pnlColor = data.position.current_pnl >= 0 ? 'text-green-400' : 'text-red-400';
                    const bgColor = data.position.current_pnl >= 0 ? 'bg-green-500/10' : 'bg-red-500/10';
                    const borderColor = data.position.current_pnl >= 0 ? 'border-green-500/20' : 'border-red-500/20';
                    const sign = data.position.current_pnl >= 0 ? '+' : '';
                    
                    positionEl.innerHTML = `
                        <div class="${bgColor} border ${borderColor} rounded-lg p-3">
                            <div class="flex items-center justify-between mb-2">
                                <div class="flex items-center gap-2">
                                    <svg class="w-4 h-4 ${pnlColor}" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                    </svg>
                                    <span class="${pnlColor} font-semibold text-sm">Position ${data.position.side} active</span>
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="text-xs text-gray-400 mb-1">Prix d'entr√©e</div>
                                    <div class="font-semibold text-sm">$${data.position.entry_price.toLocaleString()}</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-xs text-gray-400 mb-1">PnL</div>
                                    <div class="${pnlColor} font-bold text-base">
                                        ${sign}$${data.position.current_pnl.toFixed(2)}
                                    </div>
                                    <div class="${pnlColor} text-xs font-semibold">
                                        ${sign}${data.position.pnl_pct.toFixed(2)}%
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                } else {
                    positionEl.innerHTML = `
                        <div class="bg-yellow-500/10 border border-yellow-500/20 rounded-lg p-3">
                            <div class="flex items-center gap-2 mb-2">
                                <svg class="w-4 h-4 text-yellow-400 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                                </svg>
                                <span class="text-yellow-400 font-semibold text-xs">Analyse du march√©...</span>
                            </div>
                            <p class="text-xs text-gray-400">Le bot surveille le march√© et attend un signal d'entr√©e optimal.</p>
                        </div>
                    `;
                }
            }
            
            // MAJ
            if (updateTimeEl) {
                const now = new Date();
                const updateTime = now.toLocaleTimeString('fr-FR', {hour: '2-digit', minute: '2-digit', second: '2-digit'});
                updateTimeEl.textContent = `MAJ: ${updateTime}`;
            }
        }

        // D√©marrer le polling pour un bot
        function startLiveStatusPolling(botId) {
            // R√©cup√©ration imm√©diate
            fetchLiveStatus(botId).then(data => updateLiveStatusDisplay(botId, data));
            
            // Puis toutes les 10 secondes
            liveStatusIntervals[botId] = setInterval(async () => {
                const data = await fetchLiveStatus(botId);
                updateLiveStatusDisplay(botId, data);
            }, 10000);
        }

        // Arr√™ter le polling pour un bot
        function stopLiveStatusPolling(botId) {
            if (liveStatusIntervals[botId]) {
                clearInterval(liveStatusIntervals[botId]);
                delete liveStatusIntervals[botId];
            }
        }

        // Arr√™ter tous les pollings
        function stopAllLiveStatusPolling() {
            Object.keys(liveStatusIntervals).forEach(botId => {
                stopLiveStatusPolling(botId);
            });
        }

        // Arr√™ter le polling quand on quitte la page
        window.addEventListener('beforeunload', stopAllLiveStatusPolling);

        loadBots();
    </script>
</body>
</html>
